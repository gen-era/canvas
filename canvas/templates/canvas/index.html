{% extends "canvas/base.html" %}
{% load static %}

{% block head %}
{% endblock head %}

{% block content %}
{% if user.is_authenticated %}
<div x-data="{
        sidebar: { isExpanded: true },
        views: { currentView: 'sampleSearch' },
        collapseSampleSearch: false,
        showSampleSearch() {
            this.views.currentView = 'sampleSearch';
            this.collapseSampleSearch = !this.collapseSampleSearch; // Toggle visibility of sample search
        },
        showSampleInput() {
            this.views.currentView = 'sampleInput';
            this.collapseSampleSearch = false; // Ensure sample search is visible for other views
        },
        showChipInput() {
            this.views.currentView = 'chipInput';
            this.collapseSampleSearch = false; // Ensure sample search is visible for other views
        }
    }"
    class="flex h-screen">
    <!-- Sidebar -->
    {% include "canvas/sidebar.html" %}

    <!-- Main content area -->
    <div class="flex-1 overflow-hidden">
        <!-- Sample Search View -->
        <div x-show="views.currentView === 'sampleSearch'" class="h-full flex">
            <div :class="collapseSampleSearch ? 'hidden' : 'w-1/2 border-r border-gray-300 p-4 overflow-auto'">
                {% include "canvas/components/sample_search.html" %}
            </div>
            <div class="flex-1 p-4 overflow-auto">
                {% include "canvas/components/chipsample_tabs.html" %}
            </div>
        </div>

        <!-- Full-sized Sample Input View -->
        <div x-show="views.currentView === 'sampleInput'" class="h-full p-4 overflow-auto">
            {% include "canvas/components/sample_input.html" %}
        </div>
        <div x-show="views.currentView === 'chipInput'" class="h-full p-4 overflow-auto">
            {% include "canvas/components/chip_input.html" %}
        </div>
    </div>
</div>
{% else %}
    {% include "canvas/login.html" %}
{% endif %}

<script>
function getSelectedInstitutions() {
     return Array.from(document.getElementsByClassName("selected-institutions-sample-search")).map(e => e.innerText)
}

function getSelectedChips() {
     return Array.from(document.getElementsByClassName("selected-chips-sample-search")).map(e => e.innerText)
}
function createSearchComponent(type, isSingleSelect = false) {
    return {
        open: false,
        searchQuery: '',
        selectedItems: [],
        selectedItem: null,
        isSingleSelect: isSingleSelect,
        selectItem(item) {
            if (this.isSingleSelect) {
                this.selectedItem = item;
            } else {
                if (!this.selectedItems.includes(item)) {
                    this.selectedItems.push(item);
                }
            }
            setTimeout(() => {
                document.dispatchEvent(new Event("searchSamples")),
                50
            });
            this.clearSearch();
        },
        clearSearch() {
            this.searchQuery = '';
            this.open = false;
        },
        removeItem(item = null) {
            if (this.isSingleSelect) {
                this.selectedItem = null;
            } else {
                this.selectedItems = this.selectedItems.filter(i => i !== item);
            }
            setTimeout(() => {
                document.dispatchEvent(new Event("searchSamples")),
                50
            });
        }
    }
}

</script>
{% endblock content %}

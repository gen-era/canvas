{% if samples.number == 1 %}
<header>
    found {{ num_samples }} samples
</header>
{% endif %}

{% for sample in samples %}
<article
     {% if forloop.last and samples.has_next %}
        hx-get="{% url 'sample_search'  %}"
        hx-trigger="intersect once"
        hx-swap="afterend"
        hx-target="this"
        hx-vals='js:{"page": "{{ samples.next_page_number }}", "search": "{{ query }}", "institutions": getSelectedInstitutions(), "chips": getSelectedChips()}'
     {% endif %}>
    <header>
        <strong>Protocol ID: {{ sample.protocol_id }}</strong>
    </header>
    <p>
        <strong>Arrival Date:</strong>
        {{ sample.arrival_date }}
    </p>
    <p>
        <strong>Entry Date:</strong>
        {{ sample.entry_date }}
    </p>

    <p>
        <strong>Institute:</strong>
        <span>
            {{ sample.institution }}
        </span>
    </p>
    <p>
        <strong>Sample Type:</strong>
        {{ sample.sample_type }}
    </p>

    {% for chipsample in sample.chipsample.all %}
    <article>
        <header>
            <strong>Chip ID:</strong>
            <span>
                {{ chipsample.chip.chip_id }}
            </span>
        </header>
        <p>

        <div hx-get="{% url 'chipsample_tab_button' %}" hx-target="#tab-buttons" hx-trigger="click"
            hx-swap="beforeend" hx-on::before-request="
            const existingTabIds = Array.from(
                document.getElementsByClassName('tab-button')
            ).map(e => e.id)
            const tabId = 'tab-button-{{  chipsample.pk }}';
            if (existingTabIds.includes(tabId)) {
                event.preventDefault();  // Stop the request
                document.getElementById(tabId).click()
            }
            " hx-vals='{"chipsample_pk": {{ chipsample.pk }}}'>
            <div hx-get="{% url 'chipsample_tab_content' %}" hx-target="#tab-contents" hx-trigger="click"
                hx-swap="beforeend" hx-vals='{"chipsample_pk": {{ chipsample.pk }}}'>

                <strong>Position:</strong>
                <a>
                    Browse
                    {{ chipsample.position }}
                </a>
            </div>
        </div>

        <a>
            View Report
        </a>

        <footer>
            <strong>Scan Date:</strong>
            <span>
                {{ chipsample.chip.scan_date }}
            </span>
        </footer>
    </article>
    {% endfor %}
    <!-- Other sample details -->
</article>
{% endfor %}

{% if not samples.has_next %}
<footer>
    No more samples
</footer>
{% endif %}

<form>
  <article
    {% if forloop.last and samples.has_next %}
      hx-get="{% url 'sample_search' %}" hx-trigger="intersect once"
      hx-swap="afterend swap:200ms" hx-target="this" hx-vals='js:{"page":
      "{{ samples.next_page_number }}", "search": "{{ query }}", "institutions":
      getSelectedInstitutions(), "chips": getSelectedChips()}'
    {% endif %}
  >
    <header>
      <nav style="float:right; transform:translateY(-25%);">
        <ul>
          <li>
            <a
              hx-post="{% url 'sample_edit' %}"
              hx-target="closest form"
              hx-swap="outerHTML swap:200ms"
              hx-vals='{"sample_pk": "{{ sample.pk }}"}'
              href="#"
            >
              <i class="fa-solid fa-check pico-color-green-500"></i>
            </a>
          </li>
          <li>
            <a
              hx-post="{% url 'sample_edit' %}"
              hx-target="closest form"
              hx-swap="outerHTML swap:200ms"
              hx-vals='{"sample_pk": "{{ sample.pk }}", "edit": "false"}'
              href="#"
            >
              <i class="fa-solid fa-xmark pico-color-red-500"></i>
            </a>
          </li>
        </ul>
      </nav>
      <div class="form-inline">
        <label for="protocol_id">
          <strong>Protocol ID:</strong>
        </label>

        <input
          autocomplete="off"
          type="text"
          name="protocol_id"
          value="{{ sample.protocol_id }}"
          required
        />
      </div>
    </header>
    <div class="form-inline">
      <label for="arrival_date">
        <strong>Arrival Date:</strong>
      </label>

      <input
        autocomplete="off"
        type="date"
        name="arrival_date"
        required
        value="{{ sample.arrival_date|date:'Y-m-d' }}"
      />
    </div>
    <p>
      <strong>Sex:</strong>
      {{ sample.sex }}
    </p>
    <p>
      <strong>Entry Date:</strong>
      {{ sample.entry_date }}
    </p>

    <p>
      <strong>Institute:</strong>
      <span> {{ sample.institution }} </span>
    </p>
    <p>
      <strong>Sample Type:</strong>
      {{ sample.sample_type }}
    </p>

    {% for chipsample in sample.chipsample.all %}
      <article>
        <header>
          <strong>Chip ID:</strong>
          <span> {{ chipsample.chip.chip_id }} </span>

          <div
            hx-get="{% url 'chipsample_tab_button' %}"
            hx-target="#tab-buttons"
            hx-trigger="click"
            hx-swap="beforeend"
            hx-on::before-request="
            const existingTabIds = Array.from(
                document.getElementsByClassName('tab-button')
            ).map(e => e.id)
            const tabId = 'tab-button-{{ chipsample.pk }}';
            if (existingTabIds.includes(tabId)) {
                event.preventDefault();  // Stop the request
                document.getElementById(tabId).click()
            }
            "
            hx-vals='{"chipsample_pk": {{ chipsample.pk }}}'
          >
            <div
              hx-get="{% url 'chipsample_tab_content' %}"
              hx-target="#tab-contents"
              hx-trigger="click"
              hx-swap="beforeend"
              hx-vals='{"chipsample_pk": {{ chipsample.pk }}}'
            >
              <strong>Position:</strong>
              <a> Browse {{ chipsample.position }} </a>
            </div>
          </div>
        </header>

        {% include 'canvas/components/reports.html' %}

        <strong>Scan Date:</strong>
        {{ chipsample.chip.scan_date }}

        <footer>
          <div
            class="badge"
            :class="{'pico-background-green-400': {{ chipsample.autosomal_call_rate }} > 0.99,
                    'pico-background-red-500': {{ chipsample.autosomal_call_rate }} <= 0.99}"
          >
            <strong>Autosomal Call Rate:</strong>
            {{ chipsample.autosomal_call_rate }}
          </div>

          <div
            class="badge"
            :class="{'pico-background-green-400': {{ chipsample.call_rate }} > 0.99,
                    'pico-background-red-500': {{ chipsample.call_rate }} <= 0.99}"
          >
            <strong>Call Rate:</strong>
            {{ chipsample.call_rate }}
          </div>

          <div
            class="badge"
            :class="{'pico-background-green-400': {{ chipsample.lrr_std_dev }} <= 0.15,
                    'pico-background-red-500': {{ chipsample.lrr_std_dev }} > 0.15}"
          >
            <strong>LRR Std. Dev.:</strong>
            {{ chipsample.lrr_std_dev }}
          </div>

          <div
            class="badge"
            :class="{'pico-background-green-400': '{{ chipsample.sex_estimate }}' === '{{ sample.sex }}',
                    'pico-background-red-500': '{{ chipsample.sex_estimate }}' !== '{{ sample.sex }}'}"
          >
            <strong>Sex Estimate:</strong>
            {{ chipsample.sex_estimate }}
          </div>
        </footer>
      </article>
    {% endfor %}
  </article>
</form>

<style>
  /* Style the form - display items horizontally */
  .form-inline {
    display: flex;
    flex-flow: row wrap;
    align-items: center;
  }
  /* Style the input fields */
  .form-inline input {
    width: 20%;
  }
</style>
